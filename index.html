<!DOCTYPE html>
<html lang=“en”>
<head>
    <meta charset=“UTF-8”>
    <meta name=“viewport” content=“width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover”>
    <link rel=“apple-touch-icon” href=“data:image/svg+xml;charset=utf-8,%3Csvg xmlns=‘http://www.w3.org/2000/svg' viewBox=‘0 0 512 512’%3E%3Crect width=‘512’ height=‘512’ fill=‘%23ffffff’/%3E%3Cpath fill=‘%23333333’ d=‘M167.6 412.8c5.6-26.9 11.2-53.5 16.9-79.9 16.7-78.5 33.3-157.1 50-235.7 1.4-6.5 2.7-13.1 4.1-19.6 1.4-6.5 2.8-13 4.2-19.5 2.8-13.1 5.7-26.2 8.5-39.3 3-20.1 6-40.3 8.9-60.4 5.8-40.3 31.1-73.2 68.8-78.1 37.7-4.9 76.3 17.6 89.6 52.9 13.3 35.2 6.7 75.9-14.9 107.3-23.4 33.9-58.6 56.9-98 66.8-39.4 9.9-78.9-15.8-87.4-55.2-8.6-40-23-68.2-44.4-107.2-10.7-19.6-21.5-39-32.5-58.4-11.1-19.4-23-38.2-34.3-57.6-22.6 39.2-45.1 78.5-67.7 117.7-22.6 39.2-45.1 78.5-67.7 117.7-2.7 4.8-5.5 9.6-8.2 14.4-2.8 4.8-5.5 9.6-8.3 14.4-5.5 9.6-11.1 19.1 16.6 28.7-11.1 19.3-22.2 38.5-33.3 57.8-22.2 38.6-44.5 77.1-66.7 115.7-2.3 4-1.1 9.1 2.9 11.4 4.1 2.3 9.1 1.1 11.4-2.9 2.3-4 1.1-9.1-2.9-11.4-4.1-2.3-9.1-1.1-11.4 2.9 22.2 38.6 44.5 77.1 66.7 115.7 11.1 19.3 22.2 38.5 33.3 57.8 5.5 9.6 11.1 19.1 16.6 28.7-2.8 4.8-5.5 9.6-8.3 14.4-2.8 4.8-5.5 9.6-8.2 14.4 22.6 39.2 45.1 78.5 67.7 117.7 22.6 39.2 45.1 78.5 67.7 117.7 11.3 19.4 23.2 38.2 34.3 57.6 11 19.5 21.8 38.8 32.5 58.4 8.5 39.4 47.9 65.1 87.4 55.2 39.4-9.9 72.4-46.1 68.1-85.9-4.3-39.8-31.4-73.4-69.9-82-38.5-8.6-77.1 13.9-90.5 49.2-13.4 35.3-6.7 76 15.1 107.5 21.8 31.5 55 55.1 93.9 60.6 38.9 5.5 76.6-21.1 82.4-59.5 5.8-38.4-18.7-76.4-56.2-84.5-37.6-8.1-75.5 14.5-88.4 49.2-12.9 34.7-6.3 74.8 15.3 105.9 21.6 31.1 54.3 54.5 92.9 59.9 38.6 5.4 76.1-21 81.9-59.2 5.8-38.2-18.6-76-55.9-84.2-37.3-8.2-74.9 14.4-87.8 48.8-12.9 34.4-6.4 74.1 15.1 105 23.1 33.1 57.7 57.4 98.6 64.9 40.9 7.5 80.5-20.9 86.6-61.3 6.1-40.4-19.3-80.1-58.7-88.8-39.5-8.7-79.1 15.3-92.6 51.6-13.6 36.2-6.8 78.2 15.8 109.9 23.6 33.1 58.7 57.2 100.5 64.5 41.8 7.3 82.3-21.6 88.5-62.9 6.1-41.3-19.9-81.9-60.2-90.7-40.3-8.8-80.8 15.8-94.6 52.9-13.8 37.2-6.9 80.3 16.3 112.8 23.9 33.5 59.3 57.7 101.4 64.8 42.1 7.1 82.9-22 89.1-63.8 6.2-41.8-20.1-83-60.8-91.8-40.7-8.9-81.6 15.9-95.6 53.5-14 37.6-7 81.1 16.5 113.9 24.2 33.7 59.8 58.1 102.2 65.1 42.4 7 83.5-22.2 89.7-64.3 6.2-42.1-20.3-83.7-61.3-92.6-41.8-8.9-82.4 15.9-96.6 54-14.2 38.1-7.1 82.1 16.8 115.3 23.9 33.2 59.3 57.2 101.4 64.1 42.1 6.9 82.9-22 89.1-63.8 6.2-41.8-20.1-83-60.8-91.8-40.7-8.9-81.6 15.9-95.6 53.5-14 37.6-7 81.1 16.5 113.9z’/%3E%3C/svg%3E”>
    <meta name=“apple-mobile-web-app-capable” content=“yes”>
    <meta name=“apple-mobile-web-app-status-bar-style” content=“black-translucent”>
    <meta name=“apple-mobile-web-app-title” content=“Piano v29”>
    <title>Piano v29</title>
    <script src=“https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js”></script>
    <script src=“https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js”></script>
    <script src=“https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js”></script>
    <script src=“https://cdn.tailwindcss.com”></script>
    <script src=“https://unpkg.com/react@18/umd/react.production.min.js”></script>
    <script src=“https://unpkg.com/react-dom@18/umd/react-dom.production.min.js”></script>
    <script src=“https://unpkg.com/@babel/standalone/babel.min.js”></script>
    <script>tailwind.config = { darkMode: ‘class’ }</script>
    <style>
        html { background-color: #f8fafc; transition: background-color 0.3s ease; height: 100%; }
        html.dark { background-color: #0f172a; }
        body { background-color: transparent; overscroll-behavior: none; width: 100%; height: 100%; margin: 0; }
        #root { height: 100%; width: 100%; display: flex; flex-direction: column; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-area-pt { padding-top: env(safe-area-inset-top); }
        
        /* 3D Flip Card Styles */
        .perspective { perspective: 1000px; }
        .card-inner { position: relative; width: 100%; transition: transform 0.6s; transform-style: preserve-3d; }
        .card-flipped { transform: rotateY(180deg); }
        .card-front, .card-back { position: relative; width: 100%; backface-visibility: hidden; }
        .card-back { position: absolute; top: 0; left: 0; transform: rotateY(180deg); height: 100%; }
        
        /* Gold Milestone Animation */
        @keyframes gold-glow {
            0% { border-color: #fbbf24; box-shadow: 0 0 5px #fbbf24; }
            50% { border-color: #f59e0b; box-shadow: 0 0 20px #f59e0b; }
            100% { border-color: #fbbf24; box-shadow: 0 0 5px #fbbf24; }
        }
        .milestone-gold { animation: gold-glow 2s infinite ease-in-out; border-width: 2px !important; }
    </style>
</head>
<body class=“text-slate-900 font-sans selection:bg-indigo-200”>
    <div id=“root”></div>
    <script type=“text/babel”>
        const userFirebaseConfig = {
            apiKey: “AIzaSyBtbs3d0ifYfTE2H0ly7-rix0wVhbdf25I”,
            authDomain: “piano10000-35804.firebaseapp.com”,
            projectId: “piano10000-35804”,
            storageBucket: “piano10000-35804.firebasestorage.app”,
            messagingSenderId: “1005611018408”,
            appId: “1:1005611018408:web:c067db2e119cc9f3a5fa9d”,
            measurementId: “G-63W95VNLK6”
        };

        const { useState, useEffect, useMemo, useRef } = React;

        // Icons
        const IconMusic = () ⟹ <svg width=“24” height=“24” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M9 18V5l12-2v13”/><circle cx=“6” cy=“18” r=“3”/><circle cx=“18” cy=“16” r=“3”/></svg>;
        const IconPlus = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M5 12h14”/><path d=“M12 5v14”/></svg>;
        const IconMinus = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M5 12h14”/></svg>;
        const IconList = () ⟹ <svg width=“24” height=“24” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><line x1=“8” y1=“6” x2=“21” y2=“6”></line><line x1=“8” y1=“12” x2=“21” y2=“12”></line><line x1=“8” y1=“18” x2=“21” y2=“18”></line><line x1=“3” y1=“6” x2=“3.01” y2=“6”></line><line x1=“3” y1=“12” x2=“3.01” y2=“12”></line><line x1=“3” y1=“18” x2=“3.01” y2=“18”></line></svg>;
        const IconClock = () ⟹ <svg width=“24” height=“24” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><circle cx=“12” cy=“12” r=“10”></circle><polyline points=“12 6 12 12 16 14”></polyline></svg>;
        const IconTrash = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M3 6h18”/><path d=“M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6”/><path d=“M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2”/><line x1=“10” y1=“11” x2=“10” y2=“17”/><line x1=“14” y1=“11” x2=“14” y2=“17”/></svg>;
        const IconCrown = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14”></path></svg>;
        const IconPlay = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><polygon points=“5 3 19 12 5 21 5 3”></polygon></svg>;
        const IconStop = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><rect x=“3” y=“3” width=“18” height=“18” rx=“2” ry=“2”></rect></svg>;
        const IconChevronDown = () ⟹ <svg width=“16” height=“16” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“3” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M6 9l6 6 6-6”/></svg>;
        const IconStar = () ⟹ <svg width=“16” height=“16” viewBox=“0 0 24 24” fill=“currentColor” stroke=“none”><polygon points=“12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2”></polygon></svg>;
        const IconRepeat = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M17 1l4 4-4 4”/><path d=“M3 11V9a4 4 0 0 1 4-4h14”/><path d=“M7 23l-4-4 4-4”/><path d=“M21 13v2a4 4 0 0 1-4 4H3”/></svg>;
        const IconRefresh = () ⟹ <svg width=“18” height=“18” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><polyline points=“23 4 23 10 17 10”></polyline><polyline points=“1 20 1 14 7 14”></polyline><path d=“M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15”></path></svg>;
        const IconCloud = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z”></path></svg>;
        const IconLogOut = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4”></path><polyline points=“16 17 21 12 16 7”></polyline><line x1=“21” y1=“12” x2=“9” y2=“12”></line></svg>;
        const IconMoon = ({ size = 20 }) ⟹ <svg width={size} height={size} viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z”></path></svg>;
        const IconSun = ({ size = 20 }) ⟹ <svg width={size} height={size} viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><circle cx=“12” cy=“12” r=“5”></circle><line x1=“12” y1=“1” x2=“12” y2=“3”></line><line x1=“12” y1=“21” x2=“12” y2=“23”></line><line x1=“4.22” y1=“4.22” x2=“5.64” y2=“5.64”></line><line x1=“18.36” y1=“18.36” x2=“19.78” y2=“19.78”></line><line x1=“1” y1=“12” x2=“3” y2=“12”></line><line x1=“21” y1=“12” x2=“23” y2=“12”></line><line x1=“4.22” y1=“19.78” x2=“5.64” y2=“18.36”></line><line x1=“18.36” y1=“5.64” x2=“19.78” y2=“4.22”></line></svg>;
        const IconFlame = () ⟹ <svg width=“18” height=“18” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><path d=“M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z”></path></svg>;
        const IconInfo = () ⟹ <svg width=“16” height=“16” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><circle cx=“12” cy=“12” r=“10”></circle><line x1=“12” y1=“16” x2=“12” y2=“12”></line><line x1=“12” y1=“8” x2=“12.01” y2=“8”></line></svg>;

        // Helpers
        function formatDecimalToHMS(decimalHours) {
            const totalSeconds = Math.round(decimalHours * 3600);
            const h = Math.floor(totalSeconds / 3600);
            const m = Math.floor((totalSeconds % 3600) / 60);
            const s = totalSeconds % 60;
            return `${h}h ${m}m ${s}s`;
        }

        // Sub-Components
        const TenThousandView = ({ tenKData, setTenKData, startDate }) ⟹ {
            const stats = useMemo(() ⟹ {
                const now = new Date();
                const start = new Date(startDate || “2024-02-01”);
                const timeDiff = now - start;
                const daysPassed = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const totalPlayed = parseFloat(tenKData.hours || 0) + (parseFloat(tenKData.minutes || 0) / 60);
                if (daysPassed ≤ 0 || totalPlayed ≈= 0) return null;
                const avgHoursPerDay = totalPlayed / daysPassed;
                const percentage = Math.min(100, (totalPlayed / 10000) * 100).toFixed(2);
                const remainingHours = 10000 - totalPlayed;
                const daysRemaining = remainingHours / avgHoursPerDay;
                const finishDate = new Date();
                finishDate.setDate(now.getDate() + daysRemaining);
                
                return { 
                    daysPassed, 
                    avgDisplay: formatDecimalToHMS(avgHoursPerDay), 
                    percentage, 
                    finishDate: finishDate.toLocaleDateString(‘en-US’, { year: ‘numeric’, month: ‘long’, day: ‘numeric’ }), 
                    nextMilestone: (Math.floor(totalPlayed / 100) + 1) * 100, 
                    daysToMilestone: Math.ceil((((Math.floor(totalPlayed / 100) + 1) * 100) - totalPlayed) / avgHoursPerDay), 
                    totalPlayed 
                };
            }, [tenKData, startDate]);

            const LEGACY_MILESTONES = [
                { hours: 900, date: new Date(“2025-11-08”), avg: “1h 24m”, note: “Finalizing Rachmaninoff 2nd Mvt.” },
                { hours: 800, date: new Date(“2025-08-18”), avg: “1h 25m”, note: “Teacher change - focusing on technique.” },
                { hours: 700, date: new Date(“2025-06-30”), avg: “1h 22m”, note: “Piano upgrade - New acoustic action.” },
                { hours: 600, date: new Date(“2025-04-30”), avg: “1h 20m”, note: “Bach Partita marathon.” },
                { hours: 500, date: new Date(“2024-12-31”), avg: “1h 29m”, note: “End of year review.” },
            ];

            return (
                <div className=“flex-1 flex flex-col p-6 overflow-y-auto w-full no-scrollbar touch-pan-y” style={{ paddingBottom: ‘env(safe-area-inset-bottom)’ }}>
                    <div className=“bg-white dark:bg-slate-800 rounded-2xl p-6 shadow-sm mb-6 border border-slate-100 dark:border-slate-700”>
                        <h2 className=“text-sm font-bold uppercase tracking-wider text-slate-400 mb-4”>Progress</h2>
                        <div className=“flex gap-4”>
                            <div className=“flex-1”><label className=“text-xs text-slate-500 mb-1 block”>Hours</label><input type=“number” value={tenKData.hours} onChange={(e) ⟹ setTenKData({…tenKData, hours: e.target.value})} className=“w-full text-2xl font-bold bg-transparent border-b-2 border-slate-200 dark:border-slate-600 outline-none dark:text-white”/></div>
                            <div className=“flex-1”><label className=“text-xs text-slate-500 mb-1 block”>Minutes</label><input type=“number” value={tenKData.minutes} onChange={(e) ⟹ setTenKData({…tenKData, minutes: e.target.value})} className=“w-full text-2xl font-bold bg-transparent border-b-2 border-slate-200 dark:border-slate-600 outline-none dark:text-white”/></div>
                        </div>
                    </div>
                    {stats && (
                        <div className=“relative pb-10”>
                            <div className=“absolute left-8 top-8 bottom-10 w-0.5 bg-slate-200 dark:bg-slate-700”></div>
                            
                            {/* Next Goal */}
                            <div className=“relative z-10 mb-8 pl-16”>
                                <div className=“absolute left-8 top-½ -translate-y-½ -translate-x-½ w-4 h-4 rounded-full bg-yellow-400 ring-4 ring-yellow-400/20”></div>
                                <div className=“bg-white dark:bg-slate-800 border border-yellow-200 p-4 rounded-xl shadow-sm”>
                                    <div className=“flex justify-between items-center”>
                                        <div>
                                            <div className=“text-yellow-600 text-[10px] font-bold uppercase”>Next Goal: {stats.nextMilestone}h</div>
                                            <div className=“text-sm font-bold dark:text-white”>{stats.finishDate}</div>
                                        </div>
                                        <div className=“text-right”>
                                            <div className=“text-xl font-bold text-yellow-500”>{stats.daysToMilestone}</div>
                                            <div className=“text-[10px] text-slate-400 font-bold”>DAYS LEFT</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Milestones */}
                            {LEGACY_MILESTONES.map((m, i) ⟹ (
                                <div key={i} className=“relative z-10 mb-8 pl-16”>
                                    <div className={`absolute left-8 top-½ -translate-y-½ -translate-x-½ w-3 h-3 rounded-full bg-slate-400 ${m.hours % 1000 ≈= 0 ? ‘milestone-gold’ : ‘’}`}></div>
                                    <div className=“flex justify-between items-center group”>
                                        <div>
                                            <div className=“font-bold text-slate-700 dark:text-slate-300”>{m.hours} Hours</div>
                                            <div className=“text-xs text-slate-400”>{m.date.toLocaleDateString()}</div>
                                        </div>
                                        <button onClick={() ⟹ alert(m.note)} className=“p-2 text-slate-300 hover:text-indigo-500 transition-colors”><IconInfo /></button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        const RepetitionsView = ({ repState, setRepState }) ⟹ {
            const { count, target, mode } = repState;
            const updateCount = (newCount) ⟹ setRepState(prev ⟹ ({ …prev, count: newCount }));
            const handleTap = () ⟹ {
                if (mode ≈= ‘UP’) updateCount(count + 1);
                else {
                    if (count ≈= 1) confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
                    updateCount(count > 0 ? count - 1 : 0);
                }
            };
            const adjustTarget = (δ) ⟹ {
                const newTarget = Math.max(1, parseInt(target) + δ);
                setRepState(prev ⟹ ({ …prev, target: newTarget, count: prev.mode ≈= ‘DOWN’ ? newTarget : prev.count }));
            };
            return (
                <div className=“flex-1 flex flex-col p-6 h-full touch-pan-y”>
                    <div className=“flex bg-slate-200 dark:bg-slate-700 p-1 rounded-xl mb-6 shrink-0”>
                        <button onClick={() ⟹ setRepState(p ⟹ ({…p, mode: ‘DOWN’, count: p.target}))} className={`flex-1 py-2 rounded-lg text-sm font-bold ${mode ≈= ‘DOWN’ ? ‘bg-white dark:bg-slate-600 shadow’ : ‘text-slate-500’}`}>Down</button>
                        <button onClick={() ⟹ setRepState(p ⟹ ({…p, mode: ‘UP’, count: 0}))} className={`flex-1 py-2 rounded-lg text-sm font-bold ${mode ≈= ‘UP’ ? ‘bg-white dark:bg-slate-600 shadow’ : ‘text-slate-500’}`}>Up</button>
                    </div>
                    
                    <div className=“flex items-center justify-between mb-6 bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700”>
                        <button onClick={() ⟹ adjustTarget(-1)} className=“p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-500”><IconMinus /></button>
                        <div className=“text-center”>
                            <div className=“text-[10px] font-bold text-slate-400 uppercase”>Target</div>
                            <div className=“text-xl font-bold dark:text-white”>{target}</div>
                        </div>
                        <button onClick={() ⟹ adjustTarget(1)} className=“p-2 bg-slate-100 dark:bg-slate-700 rounded-lg text-slate-500”><IconPlus /></button>
                    </div>

                    <button onClick={handleTap} className=“flex-1 bg-gradient-to-Best regards, from-indigo-500 to-purple-600 rounded-3xl shadow-xl flex flex-col items-center justify-center text-white mb-6 active:scale-95 transition-transform”>
                        <div className=“text-9xl font-bold”>{count}</div>
                        <div className=“text-white/60 font-medium uppercase tracking-widest mt-2 text-sm”>{mode ≈= ‘UP’ ? ‘Tap to Count’ : ‘Tap to Reduce’}</div>
                    </button>
                    <button onClick={() ⟹ updateCount(mode ≈= ‘DOWN’ ? target : 0)} className=“p-4 bg-slate-100 dark:bg-slate-800 rounded-xl text-slate-500 font-bold flex items-center justify-center gap-2”><IconRefresh /> Reset</button>
                </div>
            );
        };

        const RepertoireView = ({ pieces, deletePiece, toggleRedList }) ⟹ {
            const [filterRed, setFilterRed] = useState(false);
            const [flippedId, setFlippedId] = useState(null);
            
            const filtered = pieces.filter(p ⟹ filterRed ? p.isRedListed : true);

            return (
                <div className=“flex-1 overflow-y-auto p-4 no-scrollbar touch-pan-y” style={{ paddingBottom: ‘env(safe-area-inset-bottom)’ }}>
                    <div className=“flex justify-between items-center mb-4 px-2”>
                        <div className=“text-sm font-bold uppercase tracking-wider text-slate-400”>My Repertoire</div>
                        <button onClick={() ⟹ setFilterRed(!filterRed)} className={`p-2 rounded-lg transition-colors ${filterRed ? ‘bg-red-100 text-red-600’ : ‘bg-slate-100 text-slate-400’}`}><IconFlame /></button>
                    </div>
                    <div className=“space-y-4 pb-12”>
                        {filtered.map((piece) ⟹ (
                            <div key={piece.id} className=“perspective h-20”>
                                <div className={`card-inner h-full ${flippedId ≈= piece.id ? ‘card-flipped’ : ‘’}`}>
                                    {/* Front */}
                                    <div className={`card-front bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700 shadow-sm flex items-center justify-between ${piece.isRedListed ? ‘ring-2 ring-red-500/30’ : ‘’}`}>
                                        <div className=“flex-1” onClick={() ⟹ setFlippedId(flippedId ≈= piece.id ? null : piece.id)}>
                                            <h3 className=“font-medium dark:text-white”>{piece.title}</h3>
                                            <p className=“text-[10px] text-slate-400”>Plays: {piece.playCount}</p>
                                        </div>
                                        <div className=“flex gap-1”>
                                            <button onClick={() ⟹ toggleRedList(piece.id)} className={`p-2 transition-colors ${piece.isRedListed ? ‘text-red-500’ : ‘text-slate-200’}`}><IconFlame /></button>
                                            <button onClick={() ⟹ deletePiece(piece.id)} className=“p-2 text-slate-200 hover:text-red-500”><IconTrash /></button>
                                        </div>
                                    </div>
                                    {/* Back */}
                                    <div className=“card-back bg-indigo-50 dark:bg-indigo-900/20 p-4 rounded-xl border border-indigo-100 flex items-center justify-between” onClick={() ⟹ setFlippedId(null)}>
                                        <div className=“text-xs text-indigo-600 font-mono”>Added: {new Date(piece.dateAdded || piece.id).toLocaleDateString()}</div>
                                        <div className=“text-[10px] font-bold text-indigo-400 uppercase”>Piece Details</div>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        function App() {
            const [appMode, setAppMode] = useState(‘REPERTOIRE’); 
            const [view, setView] = useState(‘PRACTICE’); 
            const [isDark, setIsDark] = useState(() ⟹ {
                const saved = localStorage.getItem(‘pianoTheme’);
                return saved ? saved ≈= ‘dark’ : window.matchMedia(‘(prefers-color-scheme: dark)’).matches;
            });
            const [syncId, setSyncId] = useState(() ⟹ localStorage.getItem(‘pianoSyncId’) || “”);
            const [startDate, setStartDate] = useState(() ⟹ localStorage.getItem(‘pianoStartDate’) || “2024-02-01”);

            const [pieces, setPieces] = useState(() ⟹ JSON.parse(localStorage.getItem(‘pianoRepertoire_v30’) || ‘[]’));
            const [tenKData, setTenKData] = useState(() ⟹ JSON.parse(localStorage.getItem(‘piano10k_v2’) || ‘{“hours”:””, “minutes”:””}’));
            const [dailyStats, setDailyStats] = useState(() ⟹ {
                const saved = JSON.parse(localStorage.getItem(‘pianoDailyStats_v2’) || ‘{}’);
                return saved.date ≈= new Date().toDateString() ? saved : { date: new Date().toDateString(), count: 0 };
            });
            const [history, setHistory] = useState(() ⟹ JSON.parse(localStorage.getItem(‘pianoHistory_v2’) || ‘[]’));
            const [repState, setRepState] = useState({ count: 5, target: 5, mode: ‘DOWN’ });
            const [currentPiece, setCurrentPiece] = useState(null);

            // Bug Fix 1: Today Counter Interval
            useEffect(() ⟹ {
                const interval = setInterval(() ⟹ {
                    const today = new Date().toDateString();
                    setDailyStats(prev ⟹ {
                        if (prev.date ≠= today) return { date: today, count: 0 };
                        return prev;
                    });
                }, 60000); // Check every minute
                return () ⟹ clearInterval(interval);
            }, []);

            useEffect(() ⟹ {
                localStorage.setItem(‘pianoRepertoire_v30’, JSON.stringify(pieces));
                localStorage.setItem(‘piano10k_v2’, JSON.stringify(tenKData));
                localStorage.setItem(‘pianoDailyStats_v2’, JSON.stringify(dailyStats));
                localStorage.setItem(‘pianoHistory_v2’, JSON.stringify(history));
                localStorage.setItem(‘pianoStartDate’, startDate);
            }, [pieces, tenKData, dailyStats, history, startDate]);

            useEffect(() ⟹ {
                document.documentElement.classList.toggle(‘dark’, isDark);
                localStorage.setItem(‘pianoTheme’, isDark ? ‘dark’ : ‘light’);
            }, [isDark]);

            const recordPlay = (piece) ⟹ {
                const now = Date.now();
                setPieces(pieces.map(p ⟹ p.id ≈= piece.id ? { …p, lastPlayed: now, playCount: (p.playCount || 0) + 1 } : p));
                setHistory([{ historyId: now, pieceId: piece.id, title: piece.title, timestamp: now }, …history]);
                setDailyStats(prev ⟹ ({ …prev, count: prev.count + 1 }));
            };

            const pickPiece = () ⟹ {
                const now = Date.now();
                const candidates = pieces.map(p ⟹ ({ …p, score: (now - (p.lastPlayed || 0)) * (0.5 + Math.random()) }));
                const winner = candidates.sort((a,b) ⟹ b.score - a.score)[0];
                setCurrentPiece(winner);
                if (winner) recordPlay(winner);
            };

            return (
                <div className=“flex flex-col h-full bg-slate-50 dark:bg-slate-900 safe-area-pt overflow-hidden”>
                    {/* Header */}
                    <div className=“p-4 bg-white dark:bg-slate-800 border-b border-slate-200 dark:border-slate-700 shadow-sm flex justify-between items-center shrink-0 z-20”>
                        <button onClick={() => setAppMode(appMode === 'REPERTOIRE' ? '10K' : appMode === '10K' ? 'REPS' : 'REPERTOIRE')}>
                            <h1 className="text-lg font-bold flex items-center gap-2 dark:text-white">
                                {appMode === 'REPERTOIRE' && <><IconMusic /> Repertoire</>}
                                {appMode === '10K' && <><IconClock /> 10,000 Hours</>}
                                {appMode === 'REPS' && <><IconRepeat /> Repetitions</>}
                                <IconChevronDown />
                            </h1>
                        </button>
                        <div className="flex gap-2 bg-slate-100 dark:bg-slate-700 p-1 rounded-full">
                            {['PRACTICE', 'REPERTOIRE', 'SETTINGS'].map(v => (
                                <button key={v} onClick={() => {setView(v); setAppMode('REPERTOIRE')}} className={`p-2 rounded-full ${view === v && appMode === 'REPERTOIRE' ? 'bg-white dark:bg-slate-600 shadow' : 'text-slate-400'}`}>
                                    {v === 'PRACTICE' && <IconPlay />}
                                    {v === 'REPERTOIRE' && <IconList />}
                                    {v === 'SETTINGS' && <IconSettings />}
                                </button>
                            ))}
                        </div>
                    </div>

                    {/* Stats Bar */}
                    {appMode === 'REPERTOIRE' && (
                        <div className="bg-white dark:bg-slate-800/50 border-b dark:border-slate-700 py-2 px-4 flex justify-center gap-6 text-[10px] font-bold text-slate-400 tracking-widest shrink-0">
                            <span>TODAY: <span className="text-indigo-500">{dailyStats.count}</span></span>
                            <span>TOTAL: <span className="text-indigo-500">{pieces.reduce((s,p) => s + (p.playCount || 0), 0)}</span></span>
                        </div>
                    )}

                    {/* Main Content Area */}
                    <div className="flex-1 overflow-hidden relative">
                        {appMode === '10K' && <TenThousandView tenKData={tenKData} setTenKData={setTenKData} startDate={startDate} />}
                        {appMode === 'REPS' && <RepetitionsView repState={repState} setRepState={setRepState} />}
                        {appMode === 'REPERTOIRE' && view === 'PRACTICE' && (
                            <div className="h-full flex flex-col items-center justify-center p-6 text-center space-y-8">
                                {currentPiece ? (
                                    <div>
                                        <div className="text-[10px] font-bold text-slate-400 uppercase tracking-[0.2em] mb-2">Current Piece</div>
                                        <div className="text-3xl font-serif dark:text-white mb-4">{currentPiece.title}</div>
                                        <button onClick={() => setCurrentPiece(null)} className="px-6 py-2 bg-slate-200 dark:bg-slate-700 rounded-full text-xs font-bold text-slate-500 flex items-center gap-2 mx-auto"><IconStop /> Stop</button>
                                    </div>
                                ) : <div className="text-slate-300 italic">Ready for a session?</div>}
                                <button onClick={pickPiece} className="w-full max-w-xs py-6 bg-indigo-600 text-white rounded-2xl text-xl font-bold shadow-xl shadow-indigo-200 dark:shadow-none active:scale-95 transition-all">Next Piece</button>
                            </div>
                        )}
                        {appMode === 'REPERTOIRE' && view === 'REPERTOIRE' && <RepertoireView pieces={pieces} deletePiece={id => setPieces(pieces.filter(p => p.id !== id))} toggleRedList={id => setPieces(pieces.map(p => p.id === id ? {...p, isRedListed: !p.isRedListed} : p))} />}
                        {appMode === 'REPERTOIRE' && view === 'SETTINGS' && (
                            <div className="p-6 space-y-6 overflow-y-auto h-full touch-pan-y no-scrollbar">
                                <div className="text-sm font-bold uppercase text-slate-400">Settings</div>
                                <div className="bg-white dark:bg-slate-800 p-4 rounded-xl space-y-4">
                                    <div className="flex justify-between items-center">
                                        <span className="text-sm font-medium dark:text-white">Dark Mode</span>
                                        <button onClick={() => setIsDark(!isDark)} className={`w-12 h-6 rounded-full p-1 transition-colors ${isDark ? 'bg-indigo-500' : 'bg-slate-200'}`}>
                                            <div className={`w-4 h-4 bg-white rounded-full transition-transform ${isDark ? 'translate-x-6' : ''}`} />
                                        </button>
                                    </div>
                                    <div className="space-y-1">
                                        <label className="text-[10px] font-bold text-slate-400 uppercase">Start Date</label>
                                        <input type="date" value={startDate} onChange={e => setStartDate(e.target.value)} className="w-full bg-slate-100 dark:bg-slate-700 dark:text-white p-2 rounded-lg outline-none" />
                                    </div>
                                </div>
                                <div className="text-center text-[10px] text-slate-400">Piano v29 • 2025.12.31</div>
                            </div>
                        )}
                    </div>

                    {/* Add Piece Input */}
                    {appMode ≈= ‘REPERTOIRE’ && (view ≈= ‘REPERTOIRE’ || view ≈= ‘PRACTICE’) && (
                        <div className=“p-6 bg-white dark:bg-slate-800 border-t dark:border-slate-700 shrink-0”>
                            <button onClick={() ⟹ {
                                const title = prompt(“New Piece Title:”);
                                if(title) setPieces([{ id: Date.now(), title, playCount: 0, dateAdded: Date.now() }, …pieces]);
                            }} className=“w-full p-4 flex items-center justify-center gap-2 text-slate-400 font-bold”><IconPlus /> Add Piece</button>
                        </div>
                    )}
                </div>
            );
        }

        const IconSettings = () ⟹ <svg width=“20” height=“20” viewBox=“0 0 24 24” fill=“none” stroke=“currentColor” strokeWidth=“2” strokeLinecap=“round” strokeLinejoin=“round”><circle cx=“12” cy=“12” r=“3”></circle><path d=“M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z”></path></svg>;

        const root = ReactDOM.createRoot(document.getElementById(‘root’));
        root.render(<App />);
    </script>
</body>
</html>
